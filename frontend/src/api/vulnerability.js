import api from './index'

export const getVulnerabilities = (params) => {
  return api.get('/vulnerabilities/', { params })
}

export const getVulnerability = (id) => {
  return api.get(`/vulnerabilities/${id}/`)
}

export const exportVulnerabilities = (params) => {
  return api.get('/vulnerabilities/export/', { 
    params,
    responseType: 'blob'
  })
}

export const sendVulnerabilityToDingtalk = (id) => {
  return api.post(`/vulnerabilities/${id}/send_to_dingtalk/`)
}

export const sendVulnerabilityToFeishu = (id) => {
  return api.post(`/vulnerabilities/${id}/send_to_feishu/`)
}

/**
 * 上传 CNVD 格式 XML 文件，后端解析并导入漏洞数据（source=cnvd）
 * @param {File} file - .xml 文件
 */
export const uploadCnvdXml = (file) => {
  const formData = new FormData()
  formData.append('file', file)
  return api.post('/vulnerabilities/import_cnvd_xml/', formData, {
    headers: { 'Content-Type': 'multipart/form-data' }
  })
}
