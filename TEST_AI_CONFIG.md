# AI配置测试指南

## 测试步骤

### 1. 配置通义千问API
1. 访问"系统配置"页面
2. 在"通义千问AI配置"卡片中点击"新增配置"
3. 填写配置：
   - **配置名称**: 例如"通义千问测试"
   - **API Key**: 从阿里云百炼控制台获取
   - **API地址**: 使用默认值（中国大陆）
   - **模型名称**: 选择 `qwen-plus`（推荐）
   - **启用AI解析**: 开启开关
4. 点击"测试连接"按钮验证API配置是否正确
5. 保存配置

### 2. 确保配置已启用
- 在通义千问配置列表中，确认"启用状态"显示为"已启用"
- 确认配置的"状态"为"启用"

### 3. 执行漏洞采集任务
1. 创建或编辑一个漏洞采集任务（使用 `collect_oss_security` 插件）
2. 确保任务关联的阿里云配置中包含已启用的通义千问配置
3. 执行任务

### 4. 查看执行日志
在执行历史中查看日志，确认AI解析是否工作：
- 查找日志中的 `"AI模型成功解析CVE XXX的字段信息"` 信息
- 查找日志中的 `"已启用AI解析功能，使用模型: qwen-plus"` 信息
- 如果有错误，会显示 `"AI解析失败，使用规则解析: XXX"`

### 5. 查看解析结果
1. 访问"漏洞数据"页面
2. 查看新采集的漏洞详情
3. 对比启用AI前后的解析效果：
   - **启用AI前**: 部分字段可能为空或不准确（如组件名、版本信息）
   - **启用AI后**: 字段应该更完整和准确

### 6. 对比测试
- 先用规则解析（关闭AI）采集一些漏洞
- 然后启用AI解析，重新采集相同的漏洞
- 对比两者的字段提取效果

## 验证AI是否生效的方法

### 方法1：查看执行日志
在执行历史中查看日志，如果看到以下信息说明AI已生效：
```
已启用AI解析功能，使用模型: qwen-plus
AI模型成功解析CVE CVE-2025-XXXX的字段信息
```

### 方法2：查看漏洞详情
对比启用AI前后的漏洞详情页面：
- **组件名**: AI解析应该能准确提取（如"Apache SIS"、"Apache Kyuubi"）
- **版本信息**: AI解析应该能提取完整版本范围
- **严重程度**: AI解析应该能识别（High/Medium/Low等）
- **描述和影响**: AI解析应该提取更完整的信息

### 方法3：测试连接功能
在系统配置页面点击"测试连接"按钮，如果显示"连接成功"，说明API配置正确。

## 常见问题

### Q: 测试连接成功，但执行任务时AI未生效？
A: 检查：
1. 通义千问配置的"启用AI解析"开关是否已打开
2. 任务关联的阿里云配置是否是包含通义千问配置的那个
3. 查看执行日志中是否有AI相关的错误信息

### Q: AI解析失败怎么办？
A: 
1. 检查API Key是否正确
2. 检查网络连接是否正常
3. 查看执行日志中的具体错误信息
4. AI解析失败时会自动回退到规则解析，不影响任务执行

### Q: 如何确认AI解析的结果？
A: 
1. 查看漏洞详情页面，对比字段完整度
2. 查看执行日志，确认是否有"AI模型成功解析"的信息
3. 对比启用AI前后的数据质量








